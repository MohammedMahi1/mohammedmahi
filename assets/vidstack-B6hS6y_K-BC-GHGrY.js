import{t as o,o as c,u as h,v as l,i as b,w as g,e as f,l as d,x as m,y as p,z as y,a as k,A as v,B as u,D as T,L as r}from"./index-BG3l7Xez.js";import{R as S}from"./vidstack-DWxqfdlP-DhrBRAmk.js";class ${constructor(t,i){this.i=t,this.b=i,this.ta=g(),this.Db=!1,this.ad=!1,this.bd=!1,this.Ea=new S(this.cd.bind(this)),this.Re=void 0,this.Eg=void 0,this.qg(),f(this.rg.bind(this)),c(this.dd.bind(this))}get a(){return this.i.media}get c(){return this.b.delegate.c}dd(){this.ad=!1,this.bd=!1,this.Ea.sa(),this.ta.empty()}cd(){const t=this.a.currentTime;this.b.$state.realCurrentTime()!==t&&this.ab(t)}qg(){this.u("loadstart",this.Fa),this.u("abort",this.Qe),this.u("emptied",this.sg),this.u("error",this.V),this.u("volumechange",this.bb)}tg(){this.ad||(this.ta.add(this.u("loadeddata",this.ug),this.u("loadedmetadata",this.vg),this.u("canplay",this.ic),this.u("canplaythrough",this.wg),this.u("durationchange",this.xg),this.u("play",this.yb),this.u("progress",this.jc),this.u("stalled",this.yg),this.u("suspend",this.zg),this.u("ratechange",this.Cg)),this.ad=!0)}Ag(){this.bd||(this.ta.add(this.u("pause",this.Ba),this.u("playing",this.Bg),this.u("seeked",this.cb),this.u("seeking",this.Dg),this.u("ended",this.Eb),this.u("waiting",this.ed)),this.bd=!0)}u(t,i){return d(this.a,t,i.bind(this))}Fg(t){}ab(t,i){const s={currentTime:Math.min(t,this.b.$state.seekableEnd()),played:this.a.played};this.c("time-update",s,i)}Fa(t){if(this.a.networkState===3){this.Qe(t);return}this.tg(),this.c("load-start",void 0,t)}Qe(t){this.c("abort",void 0,t)}sg(){this.c("emptied",void 0,event)}ug(t){this.c("loaded-data",void 0,t)}vg(t){this.Ag(),this.c("loaded-metadata",void 0,t),(m||p&&y(this.b.$state.source()))&&this.b.delegate.kc(this.fd(),t)}fd(){return{provider:k(this.b.$provider),duration:this.a.duration,buffered:this.a.buffered,seekable:this.a.seekable}}yb(t){this.b.$state.canPlay&&this.c("play",void 0,t)}Ba(t){this.a.readyState===1&&!this.Db||(this.Db=!1,this.Ea.sa(),this.c("pause",void 0,t))}ic(t){this.b.delegate.kc(this.fd(),t)}wg(t){this.b.$state.started()||this.c("can-play-through",this.fd(),t)}Bg(t){this.Db=!1,this.c("playing",void 0,t),this.Ea.Cb()}yg(t){this.c("stalled",void 0,t),this.a.readyState<3&&(this.Db=!0,this.c("waiting",void 0,t))}ed(t){this.a.readyState<3&&(this.Db=!0,this.c("waiting",void 0,t))}Eb(t){this.Ea.sa(),this.ab(this.a.duration,t),this.c("end",void 0,t),this.b.$state.loop()&&v(this.a.controls)&&(this.a.controls=!1)}rg(){this.b.$state.paused()&&d(this.a,"timeupdate",this.Fb.bind(this))}Fb(t){this.ab(this.a.currentTime,t)}xg(t){this.b.$state.ended()&&this.ab(this.a.duration,t),this.c("duration-change",this.a.duration,t)}bb(t){const i={volume:this.a.volume,muted:this.a.muted};this.c("volume-change",i,t)}cb(t){this.ab(this.a.currentTime,t),this.c("seeked",this.a.currentTime,t),Math.trunc(this.a.currentTime)===Math.trunc(this.a.duration)&&u(this.a.duration)>u(this.a.currentTime)&&(this.ab(this.a.duration,t),this.a.ended||this.b.player.dispatch(new T("media-play-request",{trigger:t})))}Dg(t){this.c("seeking",this.a.currentTime,t)}jc(t){const i={buffered:this.a.buffered,seekable:this.a.seekable};this.c("progress",i,t)}zg(t){this.c("suspend",void 0,t)}Cg(t){this.c("rate-change",this.a.playbackRate,t)}V(t){const i=this.a.error;if(!i)return;const s={message:i.message,code:i.code,mediaError:i};this.c("error",s,t)}}class E{constructor(t,i){this.i=t,this.b=i,this.Gb.onaddtrack=this.Gg.bind(this),this.Gb.onremovetrack=this.Hg.bind(this),this.Gb.onchange=this.Ig.bind(this),d(this.b.audioTracks,"change",this.Jg.bind(this))}get Gb(){return this.i.media.audioTracks}Gg(t){const i=t.track;if(i.label==="")return;const s={id:i.id.toString(),label:i.label,language:i.language,kind:i.kind,selected:!1};this.b.audioTracks[r.pa](s,t),i.enabled&&(s.selected=!0)}Hg(t){const i=this.b.audioTracks.getById(t.track.id);i&&this.b.audioTracks[r.Zb](i,t)}Ig(t){let i=this.Se();if(!i)return;const s=this.b.audioTracks.getById(i.id);s&&this.b.audioTracks[r.qa](s,!0,t)}Se(){return Array.from(this.Gb).find(t=>t.enabled)}Jg(t){const{current:i}=t.detail;if(!i)return;const s=this.Gb.getTrackById(i.id);if(s){const e=this.Se();e&&(e.enabled=!1),s.enabled=!0}}}class A{constructor(t,i){this.a=t,this.b=i,this.scope=o(),this.W=null}setup(){new $(this,this.b),"audioTracks"in this.media&&new E(this,this.b),c(()=>{this.a.srcObject=null,this.a.removeAttribute("src");for(const t of this.a.querySelectorAll("source"))t.remove();this.a.load()})}get type(){return""}get media(){return this.a}get currentSrc(){return this.W}setPlaybackRate(t){this.a.playbackRate=t}async play(){return this.a.play()}async pause(){return this.a.pause()}setMuted(t){this.a.muted=t}setVolume(t){this.a.volume=t}setCurrentTime(t){this.a.currentTime=t}setPlaysInline(t){h(this.a,"playsinline",t)}async loadSource({src:t,type:i},s){this.a.preload=s||"",l(t)?(this.an(),this.a.srcObject=t):(this.a.srcObject=null,b(t)?i!=="?"?this.Ym({src:t,type:i}):(this.an(),this.a.src=this.nl(t)):(this.an(),this.a.src=window.URL.createObjectURL(t))),this.a.load(),this.W={src:t,type:i}}Ym(t,i){const s=this.a.querySelector("source[data-vds]"),e=s??document.createElement("source");h(e,"src",this.nl(t.src)),h(e,"type",t.type!=="?"?t.type:i),h(e,"data-vds",""),s||this.a.append(e)}an(){var t;(t=this.a.querySelector("source[data-vds]"))==null||t.remove()}nl(t){const{clipStartTime:i,clipEndTime:s}=this.b.$state,e=i(),a=s();return e>0&&a>0?`${t}#t=${e},${a}`:e>0?`${t}#t=${e}`:a>0?`${t}#t=0,${a}`:t}}export{A as H};
