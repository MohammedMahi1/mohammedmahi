import{t as m,q as k,C as n,p as y,e as g,i as v,G as f,H as r,J as w}from"./index-DRROSflN.js";import{E as T,t as p}from"./vidstack-BTBRWcYx-sGbwSono.js";import{resolveYouTubeVideoId as $}from"./vidstack-DscYSLiW-CA6XwpqT.js";const c={Rj:-1,Ve:0,We:1,Ng:2,Og:3,Pg:5};class P extends T{constructor(t,s){super(t),this.b=s,this.$$PROVIDER_TYPE="YOUTUBE",this.scope=m(),this.O=k(""),this.nc=-1,this.oc=-1,this.Wk=!1,this.Ga=0,this.Ha=new n(0,0),this.W=null,this.F=null,this.H=null,this.language="en",this.color="red",this.cookies=!1}get c(){return this.b.delegate.c}get currentSrc(){return this.W}get type(){return"youtube"}get videoId(){return this.O()}preconnect(){y(this.fb())}setup(){super.setup(),g(this.ld.bind(this)),this.c("provider-setup",this)}async play(){const{paused:t}=this.b.$state;return this.F||(this.F=p(()=>{if(this.F=null,t())return"Timed out."}),this.q("playVideo")),this.F.promise}async pause(){const{paused:t}=this.b.$state;return this.H||(this.H=p(()=>{this.H=null,t()}),this.q("pauseVideo")),this.H.promise}setMuted(t){t?this.q("mute"):this.q("unMute")}setCurrentTime(t){this.Wk=this.b.$state.paused(),this.q("seekTo",t),this.c("seeking",t)}setVolume(t){this.q("setVolume",t*100)}setPlaybackRate(t){this.q("setPlaybackRate",t)}async loadSource(t){if(!v(t.src)){this.W=null,this.O.set("");return}const s=$(t.src);this.O.set(s??""),this.W=t}fb(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}ld(){this.I();const t=this.O();if(!t){this.db.set("");return}this.db.set(`${this.fb()}/embed/${t}`),this.c("load-start")}Ue(){const{keyDisabled:t}=this.b.$props,{$iosControls:s}=this.b,{controls:i,muted:a,playsInline:h}=this.b.$state,e=i()||s();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:e?1:void 0,color:this.color,controls:e?1:0,disablekb:!e||t()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:e?1:3,mute:a()?1:0,playsinline:h()?1:0}}q(t,s){this.hd({event:"command",func:t,args:s?[s]:void 0})}mc(){window.setTimeout(()=>this.hd({event:"listening"}),100)}nd(t){this.c("loaded-metadata"),this.c("loaded-data"),this.b.delegate.kc(void 0,t)}Ba(t){var s;(s=this.H)==null||s.resolve(),this.H=null,this.c("pause",void 0,t)}Fb(t,s){const{duration:i,realCurrentTime:a}=this.b.$state,h=this.nc===c.Ve,e=h?i():t,o={currentTime:e,played:this.Ek(e)};this.c("time-update",o,s),!h&&Math.abs(e-a())>1&&this.c("seeking",e,s)}Ek(t){return this.Ga>=t?this.Ha:this.Ha=new n(0,this.Ga=t)}jc(t,s,i){const a={buffered:new n(0,t),seekable:s};this.c("progress",a,i);const{seeking:h,realCurrentTime:e}=this.b.$state;h()&&t>e()&&this.cb(i)}cb(t){const{paused:s,realCurrentTime:i}=this.b.$state;window.clearTimeout(this.oc),this.oc=window.setTimeout(()=>{this.c("seeked",i(),t),this.oc=-1},s()?100:0),this.Wk=!1}Eb(t){const{seeking:s}=this.b.$state;s()&&this.cb(t),this.c("pause",void 0,t),this.c("end",void 0,t)}Sg(t,s){var d,u;const{started:i,paused:a,seeking:h}=this.b.$state,e=t===c.We,o=t===c.Og,l=(a()||this.F)&&(o||e);if(o&&this.c("waiting",void 0,s),h()&&e&&this.cb(s),!i()&&l&&this.Wk){(d=this.F)==null||d.reject("invalid internal play operation"),this.F=null,e&&(this.pause(),this.Wk=!1);return}switch(l&&((u=this.F)==null||u.resolve(),this.F=null,this.c("play",void 0,s)),t){case c.Pg:this.nd(s);break;case c.We:this.c("playing",void 0,s);break;case c.Ng:this.Ba(s);break;case c.Ve:this.Eb(s);break}this.nc=t}jd({info:t},s){var e;if(!t)return;const{title:i,intrinsicDuration:a,playbackRate:h}=this.b.$state;if(f(t.videoData)&&t.videoData.title!==i()&&this.c("title-change",t.videoData.title,s),r(t.duration)&&t.duration!==a()){if(r(t.videoLoadedFraction)){const o=((e=t.progressState)==null?void 0:e.loaded)??t.videoLoadedFraction*t.duration,l=new n(0,t.duration);this.jc(o,l,s)}this.c("duration-change",t.duration,s)}if(r(t.playbackRate)&&t.playbackRate!==h()&&this.c("rate-change",t.playbackRate,s),t.progressState){const{current:o,seekableStart:l,seekableEnd:d,loaded:u,duration:b}=t.progressState;this.Fb(o,s),this.jc(u,new n(l,d),s),b!==a()&&this.c("duration-change",b,s)}if(r(t.volume)&&w(t.muted)){const o={muted:t.muted,volume:t.volume/100};this.c("volume-change",o,s)}r(t.playerState)&&t.playerState!==this.nc&&this.Sg(t.playerState,s)}I(){this.nc=-1,this.oc=-1,this.Ga=0,this.Ha=new n(0,0),this.F=null,this.H=null,this.Wk=!1}}export{P as YouTubeProvider};
